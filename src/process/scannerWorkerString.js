export const workerCode = `var S=Object.create;var{getPrototypeOf:b,defineProperty:g,getOwnPropertyNames:I}=Object;var $=Object.prototype.hasOwnProperty;var x=(e,a,s)=>{s=e!=null?S(b(e)):{};let t=a||!e||!e.__esModule?g(s,"default",{value:e,enumerable:!0}):s;for(let r of I(e))if(!$.call(t,r))g(t,r,{get:()=>e[r],enumerable:!0});return t};var u=require("worker_threads");var d=x(require("fs")),C=100,D=10,k=()=>new Promise((e)=>setImmediate(e)),P=async()=>{try{let a=d.readdirSync("/proc",{withFileTypes:!0}).filter((r)=>r.isDirectory()&&/^\\d+$/.test(r.name)),s=[],t=0;for(let r of a){let c=+r.name;try{let o;try{let f=()=>d.readFileSync(\`/proc/\${c}/cmdline\`,"utf8");o=await Promise.race([new Promise((y,l)=>{try{y(f())}catch(m){l(m)}}),new Promise((y,l)=>setTimeout(()=>l(new Error(\`Timeout reading cmdline for PID \${c}\`)),C))])}catch(f){continue}let n;try{n=d.readFileSync(\`/proc/\${c}/status\`,"utf8")}catch(f){continue}if(n.includes("State:	T")||n.includes("State:	Z"))continue;let p;try{p=d.readlinkSync(\`/proc/\${c}/cwd\`)}catch(f){}let h=o.split("\\x00").filter((f)=>f.trim()!=="");if(h.length>0)s.push([c,h[0],h.slice(1),p])}catch(o){}if(t++,t%D===0)await k()}return s}catch(e){return console.error("Process discovery error:",e.message),[]}};var w=require("child_process"),M=()=>new Promise((e)=>w.exec("wmic process get ProcessID,ExecutablePath /format:csv",(a,s)=>{e(s.toString().split(\`\\r
\`).slice(2).map((t)=>{let r=t.trim().split(",").slice(1).reverse();return[parseInt(r[0])||r[0],r[1]]}).filter((t)=>t[1]))}));var v=process.platform==="linux"?P:M,T;function i(e){if(!i.cache)i.cache=new Map;if(i.cache.has(e))return i.cache.get(e);let s=e.toLowerCase().replaceAll("\\\\","/").split("/");if(/^[a-z]:$/.test(s[0])||s[0]==="")s.shift();let t=[],r=["64",".x64","x64","_64"];for(let c=0;c<s.length||c===1;c++){let o=s.slice(-c).join("/");if(!o)continue;t.push(o);for(let n of r)if(o.includes(n))t.push(o.replace(n,""))}if(i.cache.set(e,t),i.cache.size>1000){let c=i.cache.keys();i.cache.delete(c.next().value)}return t}function L(e,a,s,t){if(!e)return!1;if(!(!e.a||s&&s.includes(e.a)))return!1;return e.n.some((c)=>{if(c[0]===">")return c.substring(1)===a[0];return a.some((o)=>c===o||t&&\`\${t}/\${o}\`.includes(\`/\${c}\`))})}async function z(){let e=performance.now(),a=0;try{let s=await v();a=s.length;let t=new Set,r=new Map;for(let o of T)if(o.e&&o.e.n)for(let n of o.e.n){let p=n[0]===">"?n.substring(1):n;if(!r.has(p))r.set(p,[]);r.get(p).push(o)}for(let[o,n,p,h=""]of s){if(!n)continue;let f=i(n),y=new Set;for(let l of f)if(r.has(l))r.get(l).forEach((m)=>y.add(m));for(let l of y)try{let{e:m,i:E,n:_}=l;if(L(m,f,p,h))t.add({id:E,name:_,pid:o})}catch(m){u.parentPort.postMessage({type:"error",error:"Error during processing: "+m+\`
Caused by: \`+JSON.stringify(l)})}}let c=performance.now()-e;u.parentPort.postMessage({type:"scan_results",games:Array.from(t),stats:{scanTimeMs:c,processCount:a}})}catch(s){let t=performance.now()-e;u.parentPort.postMessage({type:"error",error:s.message,stats:{scanTimeMs:t,processCount:a}})}}u.parentPort.on("message",async(e)=>{switch(e.type){case"init":T=e.detectable,i.cache=new Map,u.parentPort.postMessage({type:"initialized"});break;case"scan":await z();break;case"clear_cache":if(i.cache)i.cache.clear();u.parentPort.postMessage({type:"cache_cleared"});break}});
`;